Import('env')

tarball = env.File('zlog-1.2.12.tar.gz')

unpack_dir = env.Dir('.')

include_dir = env['INC_DIR'].Dir("zlog")

target_incs = [
	include_dir.File('zlog.h'),
]

target_libs = [
	env['LIB_DIR'].File('libzlog.so'),
]

cmd = env.Command([ target_incs, target_libs ], [ tarball ], [
  Mkdir(unpack_dir),
  '$TAR -xvf $SOURCE -C %s --strip-components=1' %(unpack_dir.path),
	'cd %s ; CC=%s make PREFIX=%s INSTALL_INCLUDE_PATH=%s INSTALL_LIBRARY_PATH=%s WARNINGS= install' %(unpack_dir.abspath, env['CC'], unpack_dir.abspath, include_dir.abspath, env['LIB_DIR']),
  'rm %s/libzlog.a' %(env['LIB_DIR']),
	])

# zlog will get unpacked in my do directory. Scons needs to know about this.
env.SideEffect(unpack_dir.path , cmd)

env.Alias('zlog', cmd)
